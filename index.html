<html>
<head>
	<script src="jquery/jquery.js"></script>
	<script src="jquery/jquery.hotkeys.js"></script>
		<script>

		function checkKey(e){
		     switch (e.keyCode) {
		        case 40:
		            game.board.down();
		            break;
		        case 38:
		            game.board.up();
		            break;
		        case 37:
		            game.board.left();
		            break;
		        case 39:
		            game.board.right();
		            break;
		            }      
		}

		if ($.browser.mozilla) {
		    $(document).keypress (checkKey);
		} else {
		    $(document).keydown (checkKey);
		}


		//$(document).bind('keyup', 'Up',   function(){game.board.up()});
		//$(document).bind('keyup', 'Down',  function(){game.board.down()});
		//$(document).bind('keyup', 'Left',  function(){game.board.left()});
		//$(document).bind('keyup', 'Right', function(){game.board.right()});
		
		var Board = function(cell_width, tile_type) {
			this.width = document.body.clientWidth;
			this.height = document.body.clientHeight;
			this.center = [Math.floor(this.width/2), Math.floor(this.height/2)];
			this.ctx = null;
			this.cell_width = cell_width;
			this.canvas_id = 'canvas';
			this.selected = [1,1];
			
			this.character = new Image();   
			this.character.src = "images/link.png";
			this.map = [
				[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
				[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
				[1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1],
				[1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1],
				[1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1],
				[1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1],
				[1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,1],
				[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
				[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
				[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
				[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
				[1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1],
				[1,0,0,1,1,1,1,1,1,0,0,0,0,1,0,0,0,0,0,1],
				[1,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,1],
				[1,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,1],
				[1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
				[1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
				[1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
				[1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
				[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
			];
			
			this.color = function(x,y) {
				return [
					[90,189,90], // grass
					[0,0,0]    // rock
				][this.map[y][x]];
			}
			
			this.passable = function(x,y){
				return [0,1][this.map[y][x]];
			}
			
			this.generateHTML = function(parent) {
				parent.innerHTML = '<canvas id="'+this.canvas_id+'" width="'+this.width+'" height="'+this.height+'"></canvas>';
				this.ctx = $('#'+this.canvas_id)[0].getContext("2d");
			};

			this.clear = function() {
				this.ctx.clearRect(0, 0, this.width, this.height);
			};

			this.set_selected = function(new_val) {
				this.selected = new_val;
				console.log(new_val);
			};

			this.generateGrid = function() {
			  //this.drawRects(0,0,20 * (this.cell_width + 1),20 * (this.cell_width + 1), [90,90,90]);
				for (var x = 0; x < this.map[0].length; x++) {
					for (var y = 0; y < this.map.length; y++) {
						this.drawRects(x * (this.cell_width),y * (this.cell_width), this.cell_width, this.cell_width, this.color(x,y));
						//(this.selected[0] == x && this.selected[1] == y && [255, 0, 0] || this.color(x,y)));
					}
				}
				this.drawSprite((this.selected[0] * (this.cell_width)) - (this.cell_width/4),(this.selected[1] * (this.cell_width )) - 10,this.character);
			};

			this.drawRects = function(x,y,w,h,color)
			{
				this.ctx.beginPath();
				this.ctx.fillStyle = 'rgb('+color[0]+', '+color[1]+', '+color[2]+')';
				this.ctx.rect(x,y,w,h);
				this.ctx.closePath();
				this.ctx.fill();
			};
			
			this.drawSprite = function(x,y,src)
			{
				console.log(x,y);
				this.ctx.drawImage(src,x,y); 
			};
		  this.up = function()
		  {
				if(this.map[game.board.selected[1] - 1][game.board.selected[0]] == 0)
				{
		    	game.board.set_selected([game.board.selected[0], game.board.selected[1] - 1]);
					this.character.src = "images/link_back.png";
					draw();
				}
				else{
					this.character.src = "images/link_back.png";
					draw();
					return;
				}
		  };
			this.down = function()
			{
				if(this.map[game.board.selected[1] + 1][game.board.selected[0]] == 0)
			  {
					game.board.set_selected([game.board.selected[0], game.board.selected[1] + 1]); 
					this.character.src = "images/link.png";
					draw();
				}
				else{
					this.character.src = "images/link.png";
					draw();
					return;
					}
			};
			this.left = function()
			{
				if(this.map[game.board.selected[1]][game.board.selected[0] - 1] == 0)
				{
			  	game.board.set_selected([game.board.selected[0] - 1, game.board.selected[1]]);
					this.character.src = "images/link_left.png"; 
					draw();
				}
				else{
					this.character.src = "images/link_left.png";
					draw();
					return;
					}
			};
			this.right = function()
			{
				if(this.map[game.board.selected[1]][game.board.selected[0] + 1] == 0){
			  	game.board.set_selected([game.board.selected[0] + 1, game.board.selected[1]]);
					this.character.src = "images/link_right.png";
					draw();
				}
				else{
					this.character.src = "images/link_right.png";
					draw();
					return;
					}
			};
		};

		var Game = function() {
			this.board = new Board(15);

			this.init = function(parent) {
				this.board.generateHTML(parent);
			};
		};
		
		function draw() {
			game.board.clear();
			game.board.generateGrid();
		}

		var game = null;

		function init() {
		  
			game = new Game();
			game.init($('#content')[0]);
			draw();
			//return setInterval(draw, 10);
		};
		
		</script>
		<style type="text/css" media="screen">
		html,body{margin: 0; padding: 0;}
		h1{position:absolute;}
		</style>
</head>
<body>

		<div id="content"></div>

	
	
	<script>
	init();
	</script>
</body>
</html>